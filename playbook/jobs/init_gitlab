- name: setup gitlab 
  hosts: all
  user: root
  become: yes
  gather_facts: yes
  tasks:
    - include_role:
        name: gitlab
      vars:
        group: master
        namespace: gitlab
        domain: onwalk.net
        auto_issuance: true
        update_secret: true  
        oidc_issuer_url: 'https://keycloak.onwalk.net/realms/cloud-sso'
        oidc_client_id: 'gitlab-oidc'
        oidc_client_token: {{ OIDC_CLIENT_TOKEN }} 
        oidc_client_redirect_uri: 'https://gitlab.onwalk.net/users/auth/openid_connect/callback'
        tls:
          - secret_name: gitlab-tls
            keyfile: /etc/sl/onwalk.net.key
            certfile: /etc.ssl/onwalk.net.pem
        secret:
          - secret_name: gitlab-smtp-secret
            key: password
            value: "{{ SMTP_PASSWORD }}"
